#!/bin/bash
source ./helper-functions.sh


function install_apttools() {
	dpkg --add-architecture i386
	apt update
	apt install -y gdb gdbserver gdb-multiarch strace ltrace nasm file libglib2.0-dev libc6-dbg libc6-dbg:i386 libgcc-s1:i386
	error_handling "installing exploitation apt tools" "Installed exploitation apt tools"
	ln -sf /usr/bin/ltrace /opt/symlinks/
	ln -sf /usr/bin/strace /opt/symlinks/
	ln -sf /usr/bin/file /opt/symlinks/
	ln -sf /usr/bin/nasm /opt/symlinks/
	ln -sf /usr/bin/gdbserver /opt/symlinks/
}


function install_pwntools() {
	pip install --break-system-packages pwntools
	error_handling "installing pwntools" "Installed pwntools"
}


function install_pwndbg() {
	curl -qsL 'https://install.pwndbg.re' | sh -s -- -t pwndbg-gdb
	error_handling "installing pwndbg" "Installed pwndbg"
	ln -sf /usr/local/bin/pwndbg /opt/symlinks/
}


function install_ropper() {
	pipx install --global ropper
	error_handling "installing ropper" "Installed ropper"
	ln -sf /usr/local/bin/ropper /opt/symlinks/
}


function install_onegadget() {
	gem install one_gadget
	error_handling "installing one_gadget" "Installed one_gadget"
	ln -sf /usr/local/bin/one_gadget /opt/symlinks/
}


function install_exploitdb() {
	git clone https://gitlab.com/exploit-database/exploitdb.git /opt/repositories/exploitdb
	error_handling "downloading exploitdb" "Downloaded exploitdb"
	sed -i 's/\/opt\/exploitdb/\/opt\/repositories\/exploitdb/' /opt/repositories/exploitdb/.searchsploit_rc
	cp /opt/repositories/exploitdb/.searchsploit_rc ~/
	su -Pc "cp /opt/repositories/exploitdb/.searchsploit_rc ~/" - user
	ln -sf /opt/repositories/exploitdb/searchsploit /opt/symlinks
	error_handling "installing searchsploit" "Installed searchsploit"
}


function install_remotemethodguesser() {
	git clone https://github.com/qtc-de/remote-method-guesser /opt/repositories/remote-method-guesser
	sed -i 's/~\/ysoserial.jar/\/opt\/repositories\/ysoserial\/ysoserial.jar/' /opt/repositories/remote-method-guesser/src/config.properties
	chown user:user -R /opt/repositories/remote-method-guesser
	su -Pc "cd /opt/repositories/remote-method-guesser && mvn package" - user
	error_handling "installing remote-method-guesser" "Installed remote-method-guesser"
	cp /opt/repositories/remote-method-guesser/target/rmg-*.jar /opt/repositories/remote-method-guesser/rmg.jar
	echo -e '#!/bin/bash\njava -jar /opt/repositories/remote-method-guesser/rmg.jar "$@"' > /opt/repositories/remote-method-guesser/rmg
	chmod +x /opt/repositories/remote-method-guesser/rmg
	ln -sf /opt/repositories/remote-method-guesser/rmg /opt/symlinks/
}


function install_sshmitm() {
	pipx install --global ssh-mitm
	error_handling "installing ssh-mitm" "Installed ssh-mitm"
	ln -sf /usr/local/bin/ssh-mitm /opt/symlinks/
}


install_apttools
install_pwntools
install_pwndbg
install_ropper
install_onegadget
install_exploitdb
install_remotemethodguesser
install_sshmitm
